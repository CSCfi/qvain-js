<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script>  
		window.addEventListener("load", function(evt) {
		
			var token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIwNTNiZmZiY2M0MWVkYWQ0ODUzYmVhOTFmYzQyZWExOCIsIm5hbWUiOiJXb3V0ZXIgVmFuIEhlbWVsIiwiYWRtaW4iOnRydWV9.SzRhDZOKW2l1Y5VTNin43vxfbZ86QXhPVULpidMVyE8"

			var output = document.getElementById("output");
			var input = document.getElementById("input");
			var record = document.getElementById("record");
			var ws;

			var print = function(message) {
				var d = document.createElement("div");
				d.innerHTML = message;
				output.appendChild(d);
			};

			document.getElementById("open").onclick = function(evt) {
				if (ws) {
					return false;
				}
				try {
					ws = new WebSocket("ws://localhost:8080/echo",);
				}
				catch (e) {
					console.log("ws init:", e);
					print("INIT ERROR: " + e);
				}
				
				console.log("ws:", ws);
				ws.onopen = function(evt) {
					print("OPEN");
				}
				ws.onclose = function(evt) {
					print("CLOSE [" + evt.code + "]");
					ws = null;
				}
				ws.onmessage = function(evt) {
					print("RESPONSE: " + evt.data);
				}
				ws.onerror = function(evt) {
					print("ERROR: " + evt.data);
				}
				return false;
			};

			document.getElementById("send").onclick = function(evt) {
				if (!ws) {
					return false;
				}
				print("SEND: " + input.value);
				//ws.send(record.value + " " + input.value);
				ws.send("open:" + record.value + " " + input.value);
				return false;
			};

			document.getElementById("close").onclick = function(evt) {
				if (!ws) {
					return false;
				}
				ws.close();
				return false;
			};

		});
	</script>
</head>
<body>
	<table>
		<tr>
			<td valign="top" width="50%">
				<p>Click "Open" to create a connection to the server, "Send" to send a message to the server and "Close" to close the connection. You can change the message and send multiple times.</p>
				<p>
					<form>
					<button id="open" type="button">Open</button>
					<button id="close" type="button">Close</button>
					<p>
						<input id="record" type="text" value="5eb63bbbe01eeed093cb22bb8f5acdc3">
						<input id="input" type="text" value="Hello world!">
						<button id="send" type="button">Send</button>
					</form>
				</p>
			</td>
			<td valign="top" width="50%">
				<div id="output"></div>
			</td>
		</tr>
	</table>
</body>
</html>
